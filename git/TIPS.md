# 知識と宗教



## 知っておくと良いこと

Gitのコマンド関連

| コマンド | 概要 |
| --- | --- |
| `init` | 空のリポジトリを作る |
| `clone` | リモートリポジトリをローカルへ複製する |
| `status` | 現在の状態を確認する |
| `log` | コミットログを出力する |
| `diff` | あるコミット間の差分を出力する |
| `branch` | ブランチを確認する。ブランチを作る |
| `switch` | ブランチを移動する |
| `add` | 記録対象にする(ステージングする) |
| `commit` | 差分を記録する(コミットする) |
| `push` | あるブランチをリモートに反映する |
| `fetch` | リモートの情報を取得する |
| `reset` | ステージング状況をクリアする。あるコミットに戻る |
| `cherry-pick` | あるコミットだけを取り込む |
| `pull` | あるブランチを取り込む |
| `merge` | あるブランチをあるブランチへマージする |
| `rebase` | あるブランチのベースコミットを変更する |
| `stash` | 現在の変更を退避する |

Gitのコミット指定関連

| フォーマット | 概要 |
| --- | --- |
| `HEAD` | 現在いるブランチあるいはその最新のコミット |
| `FETCH_HEAD` | `fetch`の格納先ブランチあるいはその最新のコミット |
| `<commit>^` | `<commit>`コミットの一つ前のコミット |
| `<commit>~<n>` | `<commit>`コミットの`<n>`個前のコミット |
| `<commit1>..<commit2>` | `<commit1>`から`<commit2>`まで | 

Gitの特殊ファイル関連

| ファイル名 | 概要 |
| --- | --- |
| `.git` | Gitの管理情報が格納されるディレクトリ |
| `.gitignore` | Gitの管理対象外となるファイル・ディレクトリを指定する |
| `.gitattributes` | ファイル・ディレクトリの扱いを指定する |

マージ関連

| 種類 | 概要 |
| --- | --- |
| 通常マージ | すべてのコミットを取り込み、マージコミットを作成する |
| squashマージ | 一つのコミットとして取り込む |
| rebaseマージ | `rebase`を行ってからすべてのコミットを取り込む |

GitHubには本記事に書かれていること以外に、次のような便利な機能があります。

- ブランチ保護
- Issues
- Releases
- GitHub Actions (CI)
- GitHub Pages (静的サイトホスティング)
- GitHub Projects



## 宗教

最初のコミットを空コミットにすべきという教えがあります。
最初のコミットは修正が面倒くさいので、最初のコミットに意味を持たせたくないという考えに基づきます。

```
$ git commit --allow-empty -m "first commit"
```

コミットメッセージは、「どう変更したか」よりも「変更による影響はどんなか」を書くべきという教えがあります。
`Dataクラスを追加`のようなメッセージではなく`保守性のためにデータのインターフェースを使うように変更`のようなメッセージにすることで、どんなコミットなのかをわかりやすくしたいという考えに基づきます。

また、コミットメッセージにプレフィックスをつけるべきという教えがあります。
`feat: fetch JSON from R2`や`fix: ドロップしないアイテムがあるバグを修正`のようにすることで、どんなコミットなのかをわかりやすくしたいという考えに基づきます。

| プレフィックス | 意味 |
| --- | --- |
| `feat` | 機能の追加 |
| `fix` | バグの修正 |
| `refactor` | リファクタリング |
| `docs` | ドキュメントの追加 |
| `ci` | CIの追加 |

コンフリクト解消は`rebase`を行うべきという教えがあります。
`merge`で解消したときに作られるマージコミットによってコミットログが汚れるのが嫌だという考えに基づきます。
また、`rebase`を行うと歴史が改変されるため、force pushが必要になります。
が、マージ前のブランチなら歴史を改変しても差し支えないだろう、と考えます。

```
$ git rebase origin/branch
$ git push -f
```

トピックブランチ(パッチ)のプルリクエストはsquashマージすべきという教えがあります。
これは、次の考えに基づきます。

- トピックブランチはマージされたらすぐに消されることが多いため、歴史違いによるマージ不可が起きない
- トピックブランチは一つの目的を持っているため、コミットを一つに押し潰しても構わない
- 一つのコミットに押し潰すことで、コミットログを綺麗に保てる

ファイルの末尾は空白行にすべきという教えがあります。
次のようにdiffが汚くなるのが嫌だという考えに基づきます。

```diff
  console.log("foo")
- console.log("bar")
- \ No newline at end of file
+ console.log("bar")
+ console.log("baz")
+ \ No newline at end of file
```
